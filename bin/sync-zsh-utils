#!/usr/bin/env zsh

0=${(%):-%N}
PRJ_DIR=${0:A:h:h}
TEMP_DIR=$(mktemp -d -t getzshutils)

git clone --depth=1 https://github.com/belak/zsh-utils "$TEMP_DIR"

plugins=(
  completion
  editor
  history
  prompt
  utility
)
destplugin=
for plugin in $plugins; do
  if [[ $plugin == completion ]]; then
    destplugin="${plugin}s"
  else
    destplugin=$plugin
  fi
  source="$TEMP_DIR"/$plugin/$plugin.plugin.zsh
  dest=$PRJ_DIR/plugins/$destplugin/$destplugin.plugin.zsh
  cp -f "$source" "$dest"
  sed -i '' "s|zsh-utils|zephyr|g" "$dest"
  sed -i '' -E "s/setopt (HIST_)?BEEP   /setopt NO_\1BEEP/g" "$dest"
done

[[ -d "$TEMP_DIR" ]] && rm -rf "$TEMP_DIR"
